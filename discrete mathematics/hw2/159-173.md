# Задания 159-173

### 159. КС грамматика называется смешанной линейной, если в правых частях правил встречается максимум один нетерминал, причем если он есть, то находится либо на первом, либо на последнем месте. Докажите, что существует КС язык, не являющийся регулярным, который можно породить смешанной линейной грамматикой.

Грамматика:
- $S\to aA$
- $A\to Sb$
- $S\to\varepsilon$

Дает язык $a^ib^i$, не являющийся регулярным.

### 160. Постройте КС-грамматику для описаний КС грамматик.

Для всех грамматик невозможно, т.к. различных нетерминалов можно придумать произвольно много, как и элементов алфавита.

- $S\to A``\rightarrow"B ``\backslash n"S$
- $S\to\varepsilon$
- $A\to A_0$
- $A\to A_1$
- $\vdots$
- $B\to CB$
- $B\to AB$
- $B\to \varepsilon$
- $C\to a_0$
- $C\to a_1$
- $\vdots$

### 161. Верно ли, что любую КС-грамматику можно привести к форме, когда любое правило имеет вид $A\rightarrow BCD$ или $A\rightarrow a$?

$a$ может быть $\varepsilon$? Если нет, то очевидно нельзя, контрпример - грамматика $S\to\varepsilon$

Допустим, что $a\in\Sigma\cup\{\varepsilon\}$

Тогда очевидно можно, т.к. можно грамматику сначала свести к НФХ, потом к каждому правилу вида $A\to BC$ дописать $D$, где $D\to\varepsilon$ и других переходов из $D$ нет.

### 162. Приведите пример КС-языка, не являющегося регулярным, дополнение к которому также является КС.

Язык $0^i1^i$ нерегулярен, грамматика к нему - 143.

Его дополнение - $\overline L = \{0^i1^j \ |\ i\not=j\}$

$\overline L = L_0\cup L_1, L_0=\{0^i1^j\ |\ i>j\}, L_1=\{0^i1^j\ |\ i<j\}$

$L_0 =0^+(01)^*, L_1 = (01)^*1^+$

Альтернативно: $\overline L = 0\overline L_0\cup \overline L_11 \quad \overline L_0=0^*(01)^*, \overline L_1=(01)^*1^*$

КС-грамматика для $\overline L$:
- $S\to 0Q \quad S\to R1 \quad$ (либо $\overline L_0$, либо $\overline L_1$)
- $Q\to0Q \quad Q\to T \quad$ ($0^*$)
- $R\to R1 \quad R\to T \quad$ ($1^*$)
- $T\to 0T1 \quad T\to\varepsilon \quad$ ($(01)^*$)

Итого, $\overline L$ тоже КС.

### 163. Приведите пример двух КС-языков, не являющихся регулярными, пересечение которых также является КС, но не регулярным, причем отлично от обоих пересекаемых языков.

- $L_1 = \{0^i1^i \ |\ i\mid 2\}$
- $L_2 = \{0^i1^i \ |\ i\mid 3\}$
- $L_3 = L_1\cap L_2 = \{0^i1^i \ |\ i\mid 2\ \wedge\ i\mid 3 \} = \{0^i1^i \ |\ i\mid 6\}$

### 164. Предложите алгоритм проверки, что в грамматике выводится хотя бы одно слово.

Есть два варианта: либо в условии подразумевается КС грамматика, либо произвольная.

Для произвольной: какой-то бан.

Для КС: уберем все нетерминалы, тогда исходная грамматика пустая $\Leftrightarrow$ полученный язык не генерит пустую строку _(ничего другого он не может сгенерить)_.

Нетерминал $A$ генерит пустую строку $\Leftrightarrow$ $\exists$ правило $A\to B\in N^*+*, \forall b\in B$ генерит пустую строку.

Линейным сканом найдем все правила вида $A\to\varepsilon$, заменим во правых частях правил $A$ на $\varepsilon$, повторим.

### 165. Предложите алгоритм нахождения слова минимальной длины, выводящегося в заданной грамматике.

$dp[A]=0$, если $\exists : A\to\varepsilon$

Переберем правила:

- $A\to B_0a_0B_1a_1\ldots$ $\quad, B_i\in N \quad a_i\in \Sigma^*$
- $dp[A]=\min(dp[A], dp[B_0]+|a_0|+dp[B_1]+|a_1|+\ldots)$

Асимптотика: $\mathcal O(nm)$, $n$ - число правил, $m$ - средняя длина элементов в правиле.

### 166. Грамматика называется леворекурсивной, если найдется такой нетерминал $A$, что за один или более шаг из A можно вывести строку, которая начинается с $A$ ($A\Rightarrow^+Aα$). Предложите алгоритм, который проверяет, является ли грамматика леворекурсивной.

Переберем все нетерминалы как кандитаты на леворекурсивный.

Построим отношение $A\Rightarrow B\alpha$ в линию:
1. Найдем все терминалы $C: C_i\Rightarrow^+\varepsilon$
2. Переберем все переходы, $A\Rightarrow B\alpha$, если:
   1. $A\to B\ldots$
   2. $A\to C_iC_j\ldots C_kB\ldots$

Замкнем это отношение и найдем петли.

### 167. Предложите алгоритм проверки, что в заданная КС грамматика в НФХ порождает конечное число слов.

1. Найдем все терминирующие нетерминалы, т.е. $A : A\Rightarrow^*\alpha\in\Sigma^*$:
   1. Линейным сканом найдем $A\Rightarrow\alpha$
   2. Если $A\Rightarrow BC$ и $BC$ терминирующие, то $A$ тоже терминирующий $\Rightarrow$ можно найти за линию с мемоизацией.
2. Построим граф для всех правил вида $A\to BC$, каждое такое правило дает два ребра.
3. Найдем все циклы в этом графе. Если в цикле есть нетерминирующий нетерминал, то есть бесконечное число путей, оканчивающихся в нетерминирующем нетерминале $\Rightarrow$ слов бесконечно.
4. Если такого цикла нет, то слов конечно.
5. Ещё надо проверить, что в этот цикл можно прийти.

### 168. Предложите алгоритм, который получает на вход КС грамматику в НФХ, про которую с помощью алгоритма из предыдущего задания выяснили, что она порождает конечное число слов. На выход необходимо выдать самое длинное слово, которое порождается этой КСГ.

Перебор всех решений _(по какому из правил идти)_, не заходя в нетерминирующие нетерминалы, $\Omega$лул.

Будем игнорить все нетерминирующие терминалы.

$maximum(A)$ - мемоизованная функция:

Для каждого ребра вида:
- $A\to a$: $maximum[A]=\max(maximum(A), a)$
- $A\to BC$: $maximum[A]=\max(maximum(B), maximum(C))$

```python
maximum(A):
    max([a for A->a], [max(B), max(C) for A->BC])
```

### 169. Билл поменял местами шаги алгоритма приведения КСГ к НФХ: он сначала удаляет цепные правила, а затем eps-правила. Будет ли корректно работать алгоритм?

Нет, т.к. удаление $\varepsilon$-правил может привести к появлению новых цепных правил

TODO: пример

### 170. Билл поменял местами шаги алгоритма приведения КСГ к НФХ: он сначала удаляет eps-правила, а затем длинные правые части. Можно ли поправить алгоритм удаления eps-правил, чтобы он работал с длинными правыми частями? Чем эта версия алгоритма хуже оригинальной?

Алгоритм поправить можно, но время будет хуже.

TODO: пояснить

### 171. Алиса разработала свою нормальную форму грамматики, в которой каждое правило имеет вид $A→BCD$, $A→BC$ или $A→c$. Как обобщить алгоритм КЯК на грамматики в такой форме? Сравните получившийся алгоритм с оригинальным.

$$d[A][i][j] = \left(\bigvee_{A\to BC}\bigvee_{k=i}^{j-1}d[B][i][k]\wedge d[C][k+1][j]\right) \vee \left(\bigvee_{A\to BCD}\bigvee_{k=i}^{j-2}\bigvee_{l=k+1}^{j-1}d[B][i][k]\wedge d[C][k+1][l] \wedge d[D][l+1][j]\right)$$

Проход по подстрокам $\mathcal O(n^2)$, для каждой подстроки $\mathcal O(n\cdot|\Gamma|+n^2\cdot|\Gamma|)=\mathcal O(n^2\cdot|\Gamma|)$

Итого: $\mathcal O(n^4\cdot |\Gamma|)$.

### 172. Алиса разработала свою нормальную форму грамматики, в которой каждое правило имеет вид $A→BC$, $A→B$ или $A→c$. Как обобщить алгоритм КЯК на грамматики в такой форме? Сравните получившийся алгоритм с оригинальным.

$$d[A][i][j] = \left(\bigvee_{A\to BC}\bigvee_{k=i}^{j-1}d[B][i][k]\wedge d[C][k+1][j]\right) \vee \left(\bigvee_{A\to B} d[B][i][j]\right)$$

$$\mathcal O(n^2 \cdot (n|\Gamma|+|\Gamma|))=\mathcal O(n^3|\Gamma|)$$

### 173. Рассмотрим дерево разбора некоторого слова в грамматике в НФХ. Как соотносятся количество нетерминалов и терминалов в дереве?

В строго двоичном дереве соотношение узлы+листы/листы $\frac{2n-1}{n}$.